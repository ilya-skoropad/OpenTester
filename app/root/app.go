package root

import (
	"fmt"
	"ilya-skoropad/open-tester/interfaces"
	"ilya-skoropad/open-tester/services"
	"log"
	"net/http"
)

type App struct {
	appConfigFactory interfaces.IAppConfigFactory
}

func (a *App) Init() {
	InitRouter()
	a.initDI()
}

func (a *App) Run() {
	config := a.appConfigFactory.Parse()
	address := fmt.Sprintf(":%d", config.ServerPort)
	err := http.ListenAndServe(address, nil)
	if err != nil {
		log.Fatal(err.Error())
	}

	log.Println(fmt.Sprintf("server is working on address %s", address))
}

func (a *App) initDI() {
	a.appConfigFactory = services.AppConfigFactory{}
}
